import{_ as s,o as a,c as n,V as l}from"./chunks/framework.76457b72.js";const C=JSON.parse('{"title":"规范项目的 git commit message","description":"和 vue3 源码学检查 git commit message","frontmatter":{"title":"规范项目的 git commit message","description":"和 vue3 源码学检查 git commit message","date":"2023-05-29T08:55:33.000Z","tags":["git"],"layout":"post","cover":{"image":"/vp-blog/covers/git.png"}},"headers":[],"relativePath":"docs/posts/和vue3学检查提交消息.md","filePath":"docs/posts/和vue3学检查提交消息.md","lastUpdated":1688274482000}'),p={name:"docs/posts/和vue3学检查提交消息.md"},o=l(`<p>在我的 <a href="https://github.com/shenxiang11/vue-starter" target="_blank" rel="noreferrer">vue-start</a> 快速启动项目中，我学习 vue 源码的规范 git commit message 的方式，添加了校验的功能。</p><p>简单做一下集成的记录。</p><h2 id="step-1-安装-simple-git-hooks" tabindex="-1">Step 1: 安装 simple-git-hooks <a class="header-anchor" href="#step-1-安装-simple-git-hooks" aria-label="Permalink to &quot;Step 1: 安装 simple-git-hooks&quot;">​</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">simple-git-hooks</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save-dev</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>还有其他类似的 git hooks 工具，如 husky 等。</p><h2 id="step-2-配置-package-json" tabindex="-1">Step 2: 配置 package.json <a class="header-anchor" href="#step-2-配置-package-json" aria-label="Permalink to &quot;Step 2: 配置 package.json&quot;">​</a></h2><p>我们添加 simple-git-hooks 所需要的配置。</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">postinstall</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">simple-git-hooks</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">simple-git-hooks</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">commit-msg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">node scripts/verifyCommit.mjs</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="step-3-编写检测脚本" tabindex="-1">Step 3: 编写检测脚本 <a class="header-anchor" href="#step-3-编写检测脚本" aria-label="Permalink to &quot;Step 3: 编写检测脚本&quot;">​</a></h2><p>这里我们直接贴出 vue3 源码里的脚本，我们可以按需自己定制。</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// @ts-check</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> chalk </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">chalk</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">readFileSync</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> msgPath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.git/COMMIT_EDITMSG</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> msg </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">readFileSync</span><span style="color:#A6ACCD;">(msgPath</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trim</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> commitRE </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#89DDFF;">(</span><span style="color:#C3E88D;">revert: </span><span style="color:#89DDFF;">)?(</span><span style="color:#C3E88D;">feat</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">fix</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">docs</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">dx</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">style</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">refactor</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">perf</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">workflow</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">ci</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">chore</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">types</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">wip</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">release</span><span style="color:#89DDFF;">)(</span><span style="color:#A6ACCD;">\\(</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">\\)</span><span style="color:#89DDFF;">)?</span><span style="color:#C3E88D;">: .</span><span style="color:#89DDFF;">{1,50}/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">commitRE</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#A6ACCD;">(msg)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  console.log()</span></span>
<span class="line"><span style="color:#A6ACCD;">  console.error(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">chalk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">bgRed</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">white</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> ERROR </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">chalk</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">red</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">invalid commit message format.</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#A6ACCD;">    )</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;"> +</span></span>
<span class="line"><span style="color:#F07178;">      chalk.red(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">  Proper commit message format is required for automated changelog generation. Examples:</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">      ) +</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">    </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">chalk</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">green</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">feat(compiler): add &#39;comments&#39; option</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;"> +</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">    </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">chalk</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">green</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">fix(v-model): handle events on blur (close #28)</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#A6ACCD;">      )</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;"> +</span></span>
<span class="line"><span style="color:#F07178;">      chalk.red(</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">  See .github/commit-convention.md for more details.</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#F07178;">  process.exit(1)</span></span>
<span class="line"><span style="color:#F07178;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>奇怪的是 vue3 此文件名后缀是 js，但是使用了 <code>import</code> 语句，这在我的环境下是不行的，我们可以将其改为 <code>mjs</code> 后缀。</p><h2 id="step-4-设置-hooks" tabindex="-1">Step 4: 设置 hooks <a class="header-anchor" href="#step-4-设置-hooks" aria-label="Permalink to &quot;Step 4: 设置 hooks&quot;">​</a></h2><p>执行脚本，其会为我们在隐藏文件下设置相应的 hooks。</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">simple-git-hooks</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="message-规范解读" tabindex="-1">message 规范解读 <a class="header-anchor" href="#message-规范解读" aria-label="Permalink to &quot;message 规范解读&quot;">​</a></h2><p><code>?</code> 代表不是很确定且 commitizen 规范中似乎没有。</p><table><thead><tr><th>名称</th><th>意义</th></tr></thead><tbody><tr><td>feat</td><td>新功能</td></tr><tr><td>fix</td><td>修复 bug</td></tr><tr><td>docs</td><td>仅包含文档的修改</td></tr><tr><td>dx</td><td>开发体验优化 (?)</td></tr><tr><td>style</td><td>仅格式化的变动</td></tr><tr><td>refactor</td><td>重构</td></tr><tr><td>perf</td><td>提高性能的修改</td></tr><tr><td>test</td><td>添加或修改测试代码</td></tr><tr><td>workflow</td><td>项目流程上的修改 (?)</td></tr><tr><td>build</td><td>构建工具或外部依赖包的修改</td></tr><tr><td>ci</td><td>持续集成的配置文件或脚本的修改</td></tr><tr><td>chore</td><td>杂项</td></tr><tr><td>types</td><td>TS 的类型的修改 （?）</td></tr><tr><td>wip</td><td>未开发完的提交（?）</td></tr><tr><td>release</td><td>发布 （?）</td></tr><tr><td>revert</td><td>撤销某次提交</td></tr></tbody></table><h2 id="缺点" tabindex="-1">缺点 <a class="header-anchor" href="#缺点" aria-label="Permalink to &quot;缺点&quot;">​</a></h2><p>由于其执行需要依赖 node_modules，所以一开始，我在使用 degit 下载项目后，简单做了一点变更，忘记安装依赖了，便发现这时后不能检测到不规范的 message。</p><p>所以，第一个永远记得先安装依赖。实际场景中，我们大多数场景是安装完依赖，需要启动项目进行开发的，所以这个不是什么大问题。</p><p>但是，这也警示了我们，仍然有可能会有不规范的 message 会被提交到远程，如果要严格规范我们的提交，我们仍然需要创建机制，拒绝不规范的提交。</p>`,22),e=[o];function t(r,c,D,i,y,F){return a(),n("div",null,e)}const m=s(p,[["render",t]]);export{C as __pageData,m as default};
